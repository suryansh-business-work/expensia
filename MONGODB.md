# MongoDB Integration Details

## Database Schema

### Expense Model

Each expense document in MongoDB contains:

```typescript
{
  amount: Number,           // Expense amount (required, min: 0)
  category: String,         // Main category name (required)
  subcategory: String,      // Specific subcategory (required)
  categoryId: String,       // Unique category identifier (required)
  paymentMethod: String,    // Payment method used (required)
  description: String,      // Optional description
  timestamp: Date,          // When the expense occurred (required)
  createdAt: Date,         // Auto-generated by Mongoose
  updatedAt: Date          // Auto-generated by Mongoose
}
```

## Category IDs

Each expense category has a unique identifier:

- **food-dining**: Food & Dining
- **home-living**: Home & Living
- **health-wellness**: Health & Wellness
- **baby-care**: Baby Care
- **transportation**: Transportation
- **investments**: Investments
- **lifestyle**: Lifestyle
- **debt-loans**: Debt & Loans
- **miscellaneous**: Miscellaneous
- **professional**: Professional
- **personal-family**: Personal & Family
- **income**: Income

## Database Indexes

For optimal query performance, the following indexes are created:

1. **timestamp**: Descending (-1) - For sorting expenses by date
2. **category**: Ascending (1) - For filtering by category
3. **categoryId**: Ascending (1) - For filtering by category ID

## Database Connection

The application connects to MongoDB Atlas:
- **Cluster**: sibera-box.ofemtir.mongodb.net
- **Database**: sibera-restart
- **Features**: Retry writes enabled, Write concern: majority

## API Flow

1. User sends natural language message
2. ChatGPT parses the message and extracts:
   - Amount
   - Category name
   - Subcategory
   - Payment method
3. Server adds:
   - Category ID (based on category name)
   - Timestamp (current date/time)
4. Expense is saved to MongoDB
5. Response includes all fields plus MongoDB `_id`, `createdAt`, `updatedAt`

## Query Features

- Expenses are fetched in descending order by timestamp (newest first)
- Limited to 100 most recent expenses by default
- All expenses include category ID for efficient filtering

## Data Persistence

All expense data is persisted in MongoDB, ensuring:
- No data loss on server restart
- Historical data preservation
- Scalable storage
- Cloud-based accessibility
